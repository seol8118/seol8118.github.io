---
title: "RFCNN"
date: 2020-06-29
category:
  - object detection
tag :
  - object detection
sidebar:
  nav: sidebar-odTwostage
mathjax: "true"
author_profile: false
toc: true
toc_label: "Contents"
toc_icon: "cog"
toc_sticky: true
header:
  overlay_image: /assets/images/dataScience.jpg
  overlay_filter: 0.5
comments: true
---

> ML study > Object Detection > Two stage detection

<script type="text/javascript" 
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>

# RFCN (Region based Fully Convolutional Network)
- RFCN은 Faster RCNN에서 이미지마다 진행된 수백 수천 개의 ROI에 대하여 sub network를 통과시켜야 한다는 점이 문제점으로 거론되면서 Fully convolutional network를 적용하여 ROI를 구하는 동시에 classification과 BBox regression이 함께 이루어지도록 제안하였다.

## 1. RFCN 동작

<center><img src="/assets/images/od/survey13-3.jpg" ></center>

### RFCN은 Faster RCNN과 거의 비슷한 구조이며 ROI subnetwork 부분이 추가 되었다. 이로써 이전에는 ROI 계산과정에서 서로 공유되는 과정이 없었지만 CNN으로 subnetwork를 만들어 ROI 과정에서 network가 공유되도록 만들어 ROI 계산을 간략화 하였다.

feature_maps = process(image)
ROIs = region_proposal(feature_maps)
for ROI in ROIs
    patch = roi_pooling(feature_maps, ROI)
    class_scores, box = detector(patch)
    class_probabilities = softmax(class_scores)


feature_maps = process(image)
ROIs = region_proposal(feature_maps)         
score_maps = compute_score_map(feature_maps)
for ROI in ROIs
    V = region_roi_pool(score_maps, ROI)     
    class_scores, box = average(V)                   # Much simpler!
    class_probabilities = softmax(class_scores)

- 먼저 RPN은 동일한 backbone CNN network의 feature를 input으로 받는다.

- feature map (HxWxC) 을 CNN에 통과시켜 2개의 output layer가 HxWx2k, HxWx4k 가 되도록 구현한다.

- 첫번째 layer는 feature map의 한 point에서 만들어낸 k anchor box에 object가 있을 확률을 의미하며, 두 번째 layer는 anchor box를 regression 해줄 좌표, 크기 정보를 의미한다.

- 이 때 동일한 물체에 대해 여러개의 box가 나올 수 있으므로 물체가 있을 확률이 높은 순서대로 정렬한 후 Non maximum suppression (NMS) 을 적용하여 총 2000개의 ROI 만을 구해준다.

- 이 후의 과정은 Fast RCNN과 동일하다.


## 2. Faster RCNN 결과

Faster RCNN은 region proposal을 CNN으로 대체하며 mAP 성능을 올렸을 뿐 아니라 Test time에서는 Fast RCNN보다 10배 더 좋은 속도를 기록하였다.

<center><img src="/assets/images/od/fasertRCNNT05.jpg" ></center>



## 3. Faster RCNN 단점
 - Region proposal까지 CNN에 적용하여 성능향상을 가져왔지만 ROI가 이미지마다 수백번씩 진행되어야 한다는 점이 문제점으로 거론되었다.



## Reference
\[1]: [Deep Learning for Generic Object Detection: A Survey](https://doi.org/10.1007/s11263-019-01247-4)

\[2]: [RFCN 논문](https://arxiv.org/pdf/1605.06409.pdf)

\[2]: [RFCN 정리 블로그](https://medium.com/@jonathan_hui/understanding-region-based-fully-convolutional-networks-r-fcn-for-object-detection-828316f07c99)



<br><br>
